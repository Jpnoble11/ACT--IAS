<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>GALLERY</title>
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/5.0.0-alpha1/css/bootstrap.min.css"
      integrity="sha384-r4NyP46KrjDleawBgD5tp8Y7UzmLA05oM1iAEQ17CSuDqnUK2+k9luXQOfXJCJ4I"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://unpkg.com/boxicons@latest/css/boxicons.min.css"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@500&family=Rubik:wght@300;400;500;600;700;800;900&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="css/navbar.css" />
    <link rel="stylesheet" href="css/contact.css" />
    <link rel="stylesheet" href="css/gallery.css" />
  </head>
  <body>
    <header>
      <div class="container">
        <h2><span>GLY</span></h2>
        <div class="navbar">
          <nav>
            <ul>
              <li>
                <a href="./homepage" class="nav-icon">
                  <i class="uil uil-estate"></i>
                  Home
                </a>
              </li>
              <li>
                <a href="#" class="nav-icon">
                  <i class="uil uil-user"></i>
                  Gallery
                </a>
              </li>
              <li>
                <a href="./contact" class="nav-icon">
                  <i class="uil uil-message"></i>
                  Contact Me
                </a>
              </li>
              <li>
                <a href="#" id="logout-link" class="nav-icon">
                  <i class="uil uil-message"></i>
                  Log Out
                </a>
              </li>
            </ul>
          </nav>
        </div>
        <button class="hamburger">
          <div class="bar"></div>
        </button>
      </div>
    </header>
    <nav class="mobile-nav">
      <a href="./homepage">Home</a>
      <a href="./gallery">Gallery</a>
      <a href="./contact">Contact Me</a>
      <a href="#" id="mobile-logout-link">Log Out</a>
    </nav>

    <section class="Gallery">
      <div class="container mt-5">
        <div class="row">
          <div class="col-md-6">
            <h3>Upload an Image</h3>
            <input
              class="form-control"
              type="file"
              id="imageUpload"
              accept="image/*"
            />
            <button id="uploadButton" class="btn btn-primary mt-3">
              Upload
            </button>
            <div id="loadingIndicator" style="display: none">Uploading...</div>
          </div>
          <div class="col-md-6">
            <h3>Images</h3>
            <div id="allImagesDisplay" class="mt-3"></div>
          </div>
        </div>
      </div>
    </section>

    <script src="https://unpkg.com/scrollreveal"></script>
    <script src="js/navbar.js"></script>
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
      import {
        getStorage,
        ref,
        listAll,
        getDownloadURL,
        uploadBytes,
      } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-storage.js";

      // Your web app's Firebase configuration
      const firebaseConfig = {
        apiKey: "AIzaSyBGZDCphcVOI-CX808hT47KAgihFI2LOaE",
        authDomain: "iasdb-f3496.firebaseapp.com",
        databaseURL:
          "https://iasdb-f3496-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "iasdb-f3496",
        storageBucket: "iasdb-f3496.appspot.com",
        messagingSenderId: "468474107017",
        appId: "1:468474107017:web:98677254871c76110d6258",
        measurementId: "G-FLQ1YMY8VQ",
      };

      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const storage = getStorage(app);

      document.getElementById("uploadButton").addEventListener("click", () => {
        const file = document.getElementById("imageUpload").files[0];
        if (file) {
          const storageRef = ref(storage, `Image Folders/${file.name}`);
          document.getElementById("loadingIndicator").style.display = "block";
          uploadBytes(storageRef, file)
            .then((snapshot) => {
              console.log("Uploaded a blob or file!");
              return getDownloadURL(snapshot.ref);
            })
            .then((downloadURL) => {
              document.getElementById("loadingIndicator").style.display =
                "none";
              document.getElementById("imageUpload").value = "";
              addImageToAllImagesDisplay(downloadURL, file.name);
            })
            .catch((error) => {
              document.getElementById("loadingIndicator").style.display =
                "none";
              console.error("Upload failed:", error);
            });
        } else {
          alert("Please select a file first.");
        }
      });

      function displayAllImages() {
        const storageRef = ref(storage, "Image Folders");
        listAll(storageRef)
          .then((res) => {
            console.log("Listing all items:");
            res.items.forEach((itemRef) => {
              console.log("Found item:", itemRef.name);
              getDownloadURL(itemRef)
                .then((downloadURL) => {
                  console.log("Download URL:", downloadURL);
                  addImageToAllImagesDisplay(downloadURL, itemRef.name);
                })
                .catch((error) => {
                  console.error("Error getting download URL:", error);
                });
            });
          })
          .catch((error) => {
            console.error("Failed to list images:", error);
          });
      }
      function addImageToAllImagesDisplay(downloadURL, fileName) {
        const allImagesDisplay = document.getElementById("allImagesDisplay");
        const imageContainer = document.createElement("div");
        imageContainer.classList.add("image-container");

        const img = document.createElement("img");
        img.src = downloadURL;
        img.alt = fileName;
        img.classList.add("centered-image");

        // Append image to the container
        imageContainer.appendChild(img);
        allImagesDisplay.appendChild(imageContainer);
      }

      document.addEventListener("DOMContentLoaded", displayAllImages);
    </script>
    <script type="module" src="js/logout.js"></script>
  </body>
</html>
